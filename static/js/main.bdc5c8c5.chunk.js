(this["webpackJsonphopr-demo-react-hello-world"]=this["webpackJsonphopr-demo-react-hello-world"]||[]).push([[0],{16:function(e,t,n){},17:function(e,t,n){"use strict";n.r(t);var r=n(6),c=n(4),o=n(2),s=n(3),a=n.n(s),i=n(0),u=n(9),d=n(7),l=function(e){var t=Object(i.useState)(),n=Object(o.a)(t,2),r=(n[0],n[1]),c=Object(u.a)({status:"DISCONNECTED"}),s=Object(o.a)(c,2),a=s[0],l=s[1],f=Object(i.useRef)(),p=Object(d.debounce)((function(e){r(e)}),1e3),j=function(){console.info("WS CONNECTED"),l((function(e){return e.status="CONNECTED",e}))},b=function(){console.info("WS DISCONNECTED"),l((function(e){return e.status="DISCONNECTED",e})),p(+new Date)},h=function(e){console.error("WS ERROR",e),l((function(t){t.status="DISCONNECTED",t.error=String(e)})),p(+new Date)};return Object(i.useEffect)((function(){if("undefined"!==typeof window){f.current&&(console.info("WS Disconnecting.."),f.current.close(1e3,"Shutting down"));try{var t=new URL(e.wsEndpoint);t.protocol="https:"===t.protocol?"wss":"ws",e.securityToken&&(t.search="?apiToken=".concat(e.securityToken)),console.info("WS Connecting.."),f.current=new WebSocket(t),f.current.addEventListener("open",j),f.current.addEventListener("close",b),f.current.addEventListener("error",h)}catch(n){console.error("URL is invalid",e.wsEndpoint)}return function(){f.current&&(f.current.removeEventListener("open",j),f.current.removeEventListener("close",b),f.current.removeEventListener("error",h))}}}),[e.wsEndpoint,e.securityToken]),{state:a,socketRef:f}},f=n(8),p=n(1),j=function(e){var t=e.wsEndpoint,n=e.securityToken,r=Object(i.useState)(""),s=Object(o.a)(r,2),u=s[0],d=s[1],j=l({wsEndpoint:t,securityToken:n}).socketRef,b=function(e){var t=new Uint8Array(JSON.parse("[".concat(e,"]"))),n=Object(f.decode)(t);if(n[0]instanceof Uint8Array)return(new TextDecoder).decode(n[0]);throw Error("Could not decode received message: ".concat(e))},h=function(){var e=Object(c.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{n=b(t.data),console.log("WebSocket Data: ",n),d(n)}catch(r){console.error(r)}case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(i.useEffect)((function(){if(j.current)return j.current.addEventListener("message",h),function(){j.current&&j.current.removeEventListener("message",h)}}),[j.current]),Object(p.jsx)("span",{children:u||"You have no messages."})};n(16);function b(){var e=new URLSearchParams(window.location.search),t=Object(i.useState)("Hello world"),n=Object(o.a)(t,2),r=n[0],s=n[1],u=Object(i.useState)(e.get("securityToken")||""),d=Object(o.a)(u,2),l=d[0],f=d[1],b=Object(i.useState)(e.get("apiEndpoint")||"http://localhost:3001"),h=Object(o.a)(b,2),O=h[0],v=h[1],E=Object(i.useState)(""),w=Object(o.a)(E,2),S=w[0],g=w[1],m=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new Headers;return e&&(t.set("Content-Type","application/json"),t.set("Accept-Content","application/json")),t.set("Authorization","Basic "+btoa(l)),t};Object(i.useEffect)((function(){var e=function(){var e=Object(c.a)(a.a.mark((function e(){var t,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=m(),e.next=3,fetch("".concat(O,"/api/v2/account/addresses"),{headers:t}).then((function(e){return e.json()})).catch((function(e){return console.error(e)}));case 3:n=e.sent,g(null===n||void 0===n?void 0:n.hoprAddress);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[l,O]);var x=function(){var e=Object(c.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(S){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,fetch("".concat(O,"/api/v2/messages"),{method:"POST",headers:m(!0),body:JSON.stringify({recipient:S,body:r})}).catch((function(e){return console.error(e)}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(p.jsxs)("div",{children:[Object(p.jsxs)("div",{children:[Object(p.jsx)("label",{children:"API Endpoint"})," ",Object(p.jsx)("input",{name:"apiEndpoint",placeholder:O,value:O,onChange:function(e){return v(e.target.value)}})]}),Object(p.jsxs)("div",{children:[Object(p.jsx)("label",{children:"Security Token"})," ",Object(p.jsx)("input",{name:"securityToken",placeholder:l,value:l,onChange:function(e){return f(e.target.value)}})]}),Object(p.jsxs)("div",{children:[Object(p.jsx)("label",{children:"Send a message"})," ",Object(p.jsx)("input",{name:"message",value:r,placeholder:r,onChange:function(e){return s(e.target.value)}})]}),Object(p.jsx)("button",{onClick:function(){return x()},children:"Send message to node"}),Object(p.jsx)("br",{}),Object(p.jsx)("br",{}),Object(p.jsx)(j,{wsEndpoint:"".concat(O,"/api/v2/messages/websocket"),securityToken:l})]})}var h=document.getElementById("root");Object(r.render)(Object(p.jsx)(b,{}),h)}},[[17,1,2]]]);
//# sourceMappingURL=main.bdc5c8c5.chunk.js.map